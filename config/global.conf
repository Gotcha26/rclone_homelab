###############################################################################
# Variables de configuration
# Ici doivent √™tre d√©finies toutes les varaibles de la configuration locale
# Toutes les variables peuvent √™tre suplant√©es via un fichier local/config.local.conf
# Pensez aussi au tableau VARS_TO_VALIDATE de la fonction set_validation_vars()
###############################################################################

DRY_RUN=""
MAIL_TO=""
DISCORD_WEBHOOK_URL=""
FORCE_UPDATE=false

ACTION_MODE=auto
DISPLAY_MODE=verbose
TERM_WIDTH_DEFAULT=80
LOG_RETENTION_DAYS=15
LOG_LINE_MAX=1000
EDITOR=nano
DEBUG_MODE=false
DEBUG_INFOS=false

RCLONE_OPTS=(
    --temp-dir "${DIR_TMP:-}"
    --exclude '*<*'
    --exclude '*>*'
    --exclude '*:*'
    --exclude '*"*'
    --exclude '*\\*'
    --exclude '*\|*'
    --exclude '*\?*'
    --exclude '.*'
    --exclude 'Thumbs.db'
    --log-level INFO
    --stats-log-level NOTICE
    --stats=0
)

# Variables succeptibles d'√™tre n√©cessaires
FORCE_BRANCH=""
DISPLAY_MODE=simplified

# Obligatoires
ERROR_CODE=0
EXECUTED_JOBS=0


###############################################################################
# Variables techniques
###############################################################################

# Ne pas toucher
DIR_TMP="${SCRIPT_DIR}/tmp"                 # R√©pertoire temporaire pour rclone
DIR_LOG="${SCRIPT_DIR}/logs"                # R√©pertoire de logs
DIR_EXEMPLES="${SCRIPT_DIR}/exemples_files" # R√©pertoire contenant les fichier exemples
DIR_LOCAL="${SCRIPT_DIR}/local"             # R√©pertoire des fichiers locaux (utilisateur)

VERSION_FILE=".version"                         # Fichier contenant le tag (release) ou num√©ro de version
DIR_VERSION_FILE="${DIR_LOCAL}/${VERSION_FILE}" # 

EXEMPLE_CONF_LOCAL_FILE="config.main.txt"                              # Fichier d'exemple pour configuration local
CONF_LOCAL_FILE="config.local.conf"                                    # Fichier de configuration local
DIR_CONF_LOCAL_FILE="${DIR_LOCAL}/$CONF_LOCAL_FILE"                    # 
DIR_EXEMPLE_CONF_LOCAL_FILE="${DIR_EXEMPLES}/$EXEMPLE_CONF_LOCAL_FILE" # 

EXEMPLE_JOBS_FILE="jobs.txt"                               # Fichier des jobs (exemple - vierge)
JOBS_FILE="jobs.conf"                                      # Fichier des jobs
DIR_JOBS_FILE="${DIR_LOCAL}/$JOBS_FILE"                    # 
DIR_EXEMPLE_JOBS_FILE="${DIR_EXEMPLES}/$EXEMPLE_JOBS_FILE" # 

EXEMPLE_SECRET_FILE="secrets.txt"                              # Fichier d'exemple pour les secrets
SECRET_FILE="secrets.env"                                      # Fichier pour les secrets (optionnel)
DIR_SECRET_FILE="${DIR_LOCAL}/$SECRET_FILE"                    #
DIR_EXEMPLE_SECRET_FILE="${DIR_EXEMPLES}/$EXEMPLE_SECRET_FILE" #

EXEMPLE_CONF_DEV_FILE="$EXEMPLE_CONF_LOCAL_FILE"          # Fichier commun avec config.local.conf
CONF_DEV_FILE="config.dev.conf"                           # Fichier de configuration local (dev)
DIR_CONF_DEV_FILE="${DIR_LOCAL}/$EXEMPLE_CONF_DEV_FILE"   # 
DIR_EXEMPLE_CONF_DEV_FILE="${DIR_EXEMPLES}/$CONF_DEV_FILE" # Fichier de configuration local (dev)


LOG_TIMESTAMP="$(date '+%Y%m%d_%H%M%S')" # Formatage utilis√© pour les nom des fichiers
NOW="$(date '+%Y/%m/%d %H:%M:%S')"       # Formatage utilis√©e pour l'affichage √† l'√©cran

LOG_FILE_SCRIPT="main_${LOG_TIMESTAMP}.log"     # Fichier de log pour le programme rclone_homelab
DIR_LOG_FILE_SCRIPT="$DIR_LOG/$LOG_FILE_SCRIPT" # 

LOG_FILE_INFO="rclone_${LOG_TIMESTAMP}.log"   # Fichier pour receuillir le r√©sultat du traitement du job
DIR_LOG_FILE_INFO="$DIR_LOG/${LOG_FILE_INFO}" # Est cr√©√© (copie) via TMP_JOB_LOG_RAW dans jobs.sh

LOG_FILE_MAIL="msmtp_${LOG_TIMESTAMP}.log"  # Fichier de log pour msmtp (mail)
DIR_LOG_FILE_MAIL="$DIR_LOG/$LOG_FILE_MAIL" # 


###############################################################################
# Phrases - textes
###############################################################################

MAIL_DISPLAY_NAME="RCLONE Script Backup"   # Nom affich√© de l'exp√©diteur
MAIL_TO_ABS="Option --mail activ√©e mais aucun destinataire fourni (--mailto).
Le rapport ne sera pas envoy√©."            # Affich√© si aucun destinataire email fourni
MSG_PRINT_FANCY_EMPTY="‚ö†Ô∏è  Aucun texte fourni"
MSG_WAITING1=" SOYEZ PATIENT... "
MSG_WAITING2=" Mise √† jour seulement √† fin du traitement du JOB. "
MSG_WAITING3=" Pour interrompre : CTRL + C "
MSG_FILE_NOT_FOUND="Fichier jobs introuvable"
MSG_FILE_NOT_READ="Fichier jobs non lisible"
MSG_TMP_NOT_FOUND="Dossier temporaire rclone introuvable"
MSG_JOB_LINE_INVALID="Ligne invalide dans le fichier jobs"
MSG_SRC_NOT_FOUND="Dossier source introuvable ou inaccessible"
MSG_REMOTE_PROBLEM_TEMPLATE="Remote %s (%s) inaccessible, tentative de reconnexion..."
MSG_REMOTE_RECONNECTION_TEMPLATE="üîÑ  Remote %s : reconnexion effectu√©e, nouveau test..."
MSG_MSMTP_NOT_FOUND="Attention : msmtp n'est pas install√© ou introuvable dans le PATH.
Le rapport par e-mail ne sera pas envoy√©."
MSG_MSMTP_ERROR="‚ö† Echec envoi email via msmtp"
MSG_END_REPORT="--- Fin de rapport ---"
MSG_DIR_LOG_CREATE_FAIL="Impossible de cr√©er le dossier de logs"
MSG_DIR_TMP_CREATE_FAIL="Impossible de cr√©er le dossier temporaire"
MSG_RCLONE_FAIL="Erreur : rclone n'est pas install√© ou introuvable dans le PATH."
MSG_RCLONE_START="Synchronisation :"
MSG_TASK_LAUNCH="T√¢che lanc√©e le"
MSG_EMAIL_END="‚Äì Fin du message automatique ‚Äì"
MSG_EMAIL_SUCCESS="‚úÖ  Sauvegardes vers le cloud r√©ussies"
MSG_EMAIL_FAIL="‚ùå  Des erreurs lors des sauvegardes vers le cloud"
MSG_EMAIL_SUSPECT="‚ö†Ô∏è  Synchronisation r√©ussie mais aucun fichier transf√©r√©"
MSG_EMAIL_PREP="üìß  Pr√©paration de l'email..."
MSG_EMAIL_SENT="... Email envoy√© ‚úÖ "
MSG_MAIL_ERROR="‚ùå  Adresse email saisie invalide"
MSG_DRYRUN="‚úÖ  Oui : aucune modification de fichiers."
MSG_DISCORD_ABORDED="‚ö†Ô∏è  Aucun webhook Discord de d√©fini."
MSG_DISCORD_SENT="‚úÖ  Notification Discord envoy√©e."
MSG_DISCORD_PROCESSED="Trait√©e(s)"
MSG_MAJ_ERROR="Impossible de v√©rifier les mises √† jour (API GitHub muette)."
MSG_MAJ_ACCESS_ERROR="Erreur : impossible d'acc√©der au r√©pertoire du script"
MSG_MAJ_UPDATE_TEMPLATE="üì•  Nouvelle version disponible : %s (vous utilisez la %s)"
MSG_MAJ_UPDATE2="Utiliser l'argument --update-tag la prochaine fois."
MSG_MAJ_UPDATE_RELEASE_TEMPLATE="‚ö°  Mise √† jour vers la derni√®re release : %s"
MSG_MAJ_UPDATE_BRANCH_TEMPLATE="‚ö°  M√©canisme automatique de mise √† jour forc√©e sur la branche %s."
MSG_MAJ_UPDATE_BRANCH_REJECTED="Git : Rien √† mettre √† jour, vous √™tes d√©j√† sur la derni√®re version."
MSG_MAJ_UPDATE_TAG_SUCCESS_TEMPLATE="Script mis √† jour vers le tag %s !"
MSG_MAJ_UPDATE_TAG_REJECTED_TEMPLATE="Git : Rien √† mettre √† jour, vous √™tes d√©j√† sur le dernier tag %s."
MSG_MAJ_UPDATE_TAG_FAILED_TEMPLATE="Impossible de mettre √† jour vers %s : modifications locales non sauvegard√©es."